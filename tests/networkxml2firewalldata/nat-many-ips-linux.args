iptables \
--table filter \
--new-chain INP_libvirt
iptables \
--table filter \
--new-chain OUT_libvirt
iptables \
--table filter \
--new-chain FWD_libvirt_out
iptables \
--table filter \
--new-chain FWD_libvirt_in
iptables \
--table filter \
--new-chain FWD_libvirt_cross
iptables \
--table nat \
--new-chain PRT_libvirt
ip6tables \
--table filter \
--new-chain INP_libvirt
ip6tables \
--table filter \
--new-chain OUT_libvirt
ip6tables \
--table filter \
--new-chain FWD_libvirt_out
ip6tables \
--table filter \
--new-chain FWD_libvirt_in
ip6tables \
--table filter \
--new-chain FWD_libvirt_cross
ip6tables \
--table nat \
--new-chain PRT_libvirt
iptables \
--table filter \
--list INPUT
iptables \
--table filter \
--list OUTPUT
iptables \
--table filter \
--list FORWARD
iptables \
--table filter \
--list FORWARD
iptables \
--table filter \
--list FORWARD
iptables \
--table nat \
--list POSTROUTING
ip6tables \
--table filter \
--list INPUT
ip6tables \
--table filter \
--list OUTPUT
ip6tables \
--table filter \
--list FORWARD
ip6tables \
--table filter \
--list FORWARD
ip6tables \
--table filter \
--list FORWARD
ip6tables \
--table nat \
--list POSTROUTING
iptables \
--table filter \
--insert INPUT \
--in-interface virbr0 \
--protocol tcp \
--destination-port 67 \
--jump ACCEPT
iptables \
--table filter \
--insert INPUT \
--in-interface virbr0 \
--protocol udp \
--destination-port 67 \
--jump ACCEPT
iptables \
--table filter \
--insert OUTPUT \
--out-interface virbr0 \
--protocol udp \
--destination-port 68 \
--jump ACCEPT
iptables \
--table filter \
--insert INPUT \
--in-interface virbr0 \
--protocol tcp \
--destination-port 53 \
--jump ACCEPT
iptables \
--table filter \
--insert INPUT \
--in-interface virbr0 \
--protocol udp \
--destination-port 53 \
--jump ACCEPT
iptables \
--table filter \
--insert FORWARD \
--in-interface virbr0 \
--jump REJECT
iptables \
--table filter \
--insert FORWARD \
--out-interface virbr0 \
--jump REJECT
iptables \
--table filter \
--insert FORWARD \
--in-interface virbr0 \
--out-interface virbr0 \
--jump ACCEPT
iptables \
--table filter \
--insert FORWARD \
--source 192.168.122.0/24 \
--in-interface virbr0 \
--jump ACCEPT
iptables \
--table filter \
--insert FORWARD \
--destination 192.168.122.0/24 \
--out-interface virbr0 \
--match conntrack \
--ctstate ESTABLISHED,RELATED \
--jump ACCEPT
iptables \
--table nat \
--insert POSTROUTING \
--source 192.168.122.0/24 '!' \
--destination 192.168.122.0/24 \
--jump MASQUERADE
iptables \
--table nat \
--insert POSTROUTING \
--source 192.168.122.0/24 \
-p udp '!' \
--destination 192.168.122.0/24 \
--jump MASQUERADE \
--to-ports 1024-65535
iptables \
--table nat \
--insert POSTROUTING \
--source 192.168.122.0/24 \
-p tcp '!' \
--destination 192.168.122.0/24 \
--jump MASQUERADE \
--to-ports 1024-65535
iptables \
--table nat \
--insert POSTROUTING \
--source 192.168.122.0/24 \
--destination 255.255.255.255/32 \
--jump RETURN
iptables \
--table nat \
--insert POSTROUTING \
--source 192.168.122.0/24 \
--destination 224.0.0.0/24 \
--jump RETURN
iptables \
--table filter \
--insert FORWARD \
--source 192.168.128.0/24 \
--in-interface virbr0 \
--jump ACCEPT
iptables \
--table filter \
--insert FORWARD \
--destination 192.168.128.0/24 \
--out-interface virbr0 \
--match conntrack \
--ctstate ESTABLISHED,RELATED \
--jump ACCEPT
iptables \
--table nat \
--insert POSTROUTING \
--source 192.168.128.0/24 '!' \
--destination 192.168.128.0/24 \
--jump MASQUERADE
iptables \
--table nat \
--insert POSTROUTING \
--source 192.168.128.0/24 \
-p udp '!' \
--destination 192.168.128.0/24 \
--jump MASQUERADE \
--to-ports 1024-65535
iptables \
--table nat \
--insert POSTROUTING \
--source 192.168.128.0/24 \
-p tcp '!' \
--destination 192.168.128.0/24 \
--jump MASQUERADE \
--to-ports 1024-65535
iptables \
--table nat \
--insert POSTROUTING \
--source 192.168.128.0/24 \
--destination 255.255.255.255/32 \
--jump RETURN
iptables \
--table nat \
--insert POSTROUTING \
--source 192.168.128.0/24 \
--destination 224.0.0.0/24 \
--jump RETURN
iptables \
--table filter \
--insert FORWARD \
--source 192.168.150.0/24 \
--in-interface virbr0 \
--jump ACCEPT
iptables \
--table filter \
--insert FORWARD \
--destination 192.168.150.0/24 \
--out-interface virbr0 \
--match conntrack \
--ctstate ESTABLISHED,RELATED \
--jump ACCEPT
iptables \
--table nat \
--insert POSTROUTING \
--source 192.168.150.0/24 '!' \
--destination 192.168.150.0/24 \
--jump MASQUERADE
iptables \
--table nat \
--insert POSTROUTING \
--source 192.168.150.0/24 \
-p udp '!' \
--destination 192.168.150.0/24 \
--jump MASQUERADE \
--to-ports 1024-65535
iptables \
--table nat \
--insert POSTROUTING \
--source 192.168.150.0/24 \
-p tcp '!' \
--destination 192.168.150.0/24 \
--jump MASQUERADE \
--to-ports 1024-65535
iptables \
--table nat \
--insert POSTROUTING \
--source 192.168.150.0/24 \
--destination 255.255.255.255/32 \
--jump RETURN
iptables \
--table nat \
--insert POSTROUTING \
--source 192.168.150.0/24 \
--destination 224.0.0.0/24 \
--jump RETURN
iptables \
--table mangle \
--insert POSTROUTING \
--out-interface virbr0 \
--protocol udp \
--destination-port 68 \
--jump CHECKSUM \
--checksum-fill
